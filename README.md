# Homework for course by System Design. 
Курс System Design: [https://balun.courses/courses/system_design](https://balun.courses/courses/system_design)

В этом репозитории будет содержаться домашняя работа по курсу System Design:
Сервис **Social Network** - это Социальная сеть для путешественников

## Functional requirements:

* публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
* оценка и комментарии постов других путешественников;
* подписка на других путешественников, чтобы следить за их активностью;
* поиск популярных мест для путешествий и просмотр постов с этих мест;
* просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;
* комментарии содержат только текст и лайк
* оценка постов происходит через возможность сохранить лайк и комментарий

## Non-functional requirements:

### Активность:
* 10 000 000+ DAU
* доступность 99,95 %
* данные постов и комментариев хранятся всегда
* регион использования: страны СНГ
* один пользователь в неделю будет, в среднем, создавать 1 пост:
  - один пост будет содержать в среднем 5 фото
  - описание одного поста в среденем будет содержать 5000 символов
  - каждый пост будет содержать геометкку
* один пользователь в день будет, в среднем, делать 10 комментариев:
  - средний комментарий будет состоять из 100 символов
* один пользователь в день будет, в среднем, делать 20 лайков
* один пользователь в день будет, в среднем, просматривать 30 постов
* один пользователь в день будет, в среднем, просматривать 10 скринов ленты подписок
* один пользователь в день будет, в среднем, 5 раз осуществлять поиск популярных мест для путешествий
* один пользователь в день будет, в среднем, просматривать 30 скринов в ленте мест
* один вользователь в день будет, в среднем, просматривать 100 комментариев
* один пользователь в месяц будет, в среднем, подписываться на двух путешественников

### Сезонная активность (коэффициент, x):
* **Годовая** (лето, зимние и весенние праздники - максимум / весна, осень - минимум):
  - на чтение:
    * просмотр ленты, мест, постов (а так же лайки, комментарии) = 1.5x
  - на запись:
    * создание постов = 1.4x
    * лайки, комментарии, подписка = 1.5x
* **Недельная** (выходные - максимум / будни - минимум):
  - на чтение:
    * просмотр ленты, мест, постов (а так же лайки, комментарии) = 1.3x
  - на запись:
    * создание постов = 1.1x
    * лайки, комментарии, подписка = 1.3x
* **Дневная** (вечер - максимум / ночь, утро, день - минимум):
  - на чтение:
    * просмотр ленты, мест, постов (а так же лайки, комментарии) = 1.6x
  - на запись:
    * создание постов = 1.5x
    * лайки, комментарии, подписка = 1.6x
* **Общий** (средний коэффициент) с учетом частичного пересечения:
  -  на чтение:
     * просмотр ленты, мест, постов (а так же лайки, комментарии) = 2.2x
  -  на запись:
     * создание постов = 2.0x
     * лайки, комментарии, подписка = 2.2x

### Ограничения:
* один скрин ленты подписок и ленты мест имеет не более 10 постов
* один скрин ленты комментариев не более 20 комментариев
* к одному посту возмжно прикрепление не более 10 фото
* размер описания поста не более 10000 символов
* размер комментария не более 300 символов

### Производительность:
* получение одного скрина ленты подписок до 3 сек
* получение одного скрина ленты мест до 3 сек
* получение одного скрина коментариев до 2 сек
* загрузка для просмотра одного поста до 3 сек
* публикация поста до 3 сек
* публикация комментария до 0,5 сек
* подписка на блоггера до 0,5 сек
* реакция пользователя (лайк) на пост/комментарий до 0,5 сек

### Подсистемы:
* Лента (feed) - лента подписок (список коротких превью постов путешествий)
* Места (places) - лента популярных мест (список из коротких превью постов путешествий)
* Пост (post) - полное описание путешествия с указанием автора, фото, геометкой и реакциями
* Реакции - реакция пользователя на пост/комментарий:
  - лайки (likes)
  - комментарии (comments)
* Фото (photos) - фото постов

## Basic calculations

**RPS на чтение:**
* Лента (feed) 
  - один пользователь в день будет, в среднем, просматривать 10 скринов ленты подписок
    - PRS = 10 000 000 * 10 / 86 400 ~= 1 157 rps
* Места (places) 
  - один пользователь в день будет, в среднем, просматривать 30 скринов в ленте мест
  - один пользователь в день будет, в среднем, 5 раз осуществлять поиск популярных мест для путешествий
    - RPS = (10 000 000 * 30 * 5)/ 86 400 ~= 17 360 rps
* Пост (post)
  - один пользователь в день будет, в среднем, просматривать 30 постов
    - RPS = (10 000 000 * 30)/ 86 400 ~= 3 472 rps
* Комментарии (comments)
  - один вользователь в день будет, в среднем, просматривать 100 комментариев
    - (100/20) = 5 скринов ленты комментариев
    - RPS = (10 000 000 * 5)/ 86 400 ~= 578 rps
* Лайки (likes)
  - просмотр счетчика лайков в день (с учетом просмотра ленты подписок и ленты мест, и просмотра ленты коментариев)
    - 10 (feed) + 30 (places) + 100 (comments) = 140 запросов в день 1 польз-ля
    - RPS = (10 000 000 * 140) / 86 400 ~= 16 203 rps
* Фото (photos)
  - запрос фото (с учетом просмотра ленты подписок и ленты мест, и просмотра постов)
    - 10 (feed) + 30 (places) + 30 (post) * 5 (post) = 190 запросов в день 1 польз-ля
    - RPS = (10 000 000 * 190) / 86 400 ~= 21 990 rps

**RPS на запись:**
* Пост (post) 
  - один пользователь в неделю будет, в среднем, создавать 1 пост
	- RPS = 10 000 000 / 86 400 / 7 ~= 16 rps
* Фото (photos)
  - один пост будет содержать в среднем 5 фото
  - один пользователь в неделю будет, в среднем, создавать 1 пост
    - RPS = (10 000 000 * 5)/ 86 400 / 7 ~= 82 rps
* Комментарии (comments)
  - один пользователь в день будет, в среднем, делать 10 комментариев
	- RPS = (10 000 000 * 10)/ 86 400 ~= 1 157 rps
* Лайки (likes)
  - один пользователь в день будет, в среднем, делать 20 лайков
    - RPS = (10 000 000 * 20)/ 86 400 ~= 2 314 rps
  - один пользователь в месяц будет, в среднем, подписываться на 2х путешественников
	- RPS = (10 000 000 * 2)/ 86 400 / 30  ~= 8 rps

### С учетом сезонности (пиковой нагрузки)

**RPS на чтение:**
* Лента (feed)
  - PRS ~= 1 157 rps * 2.2x ~= 2 545 rps
* Места (places) 
  - PRS ~= 17 360 rps * 2.2x ~= 38 192 rps
* Пост (post) 
  - PRS ~= 3 472 rps * 2.2x ~= 7 638 rps
* Комментарии (comments)
  - PRS ~= 578 rps * 2.2x ~= 1 271 rps
* Лайки (likes)
  - PRS ~= 16 203 rps * 2.2x ~= 35 646 rps
* Фото (photos)
  - PRS ~= 21 990 rps * 2.2x ~= 48 378 rps

**RPS на запись:**
* Пост (post) 
  - RPS ~= 16 rps * 2.0x ~= 32 rps
* Фото (photos)
  - RPS ~= 82 rps * 2.0x ~= 164 rps
* Комментарии (comments)
  - RPS ~= 1 157 rps * 2.2x ~= 2 545 rps
* Лайки (likes)
  - RPS ~= 2 314 rps * 2.2x ~= 5 090 rps
* Подписка:
  - RPS ~= 8 rps * 2.2x ~= 17 rps

## Traffic
PostFeed () = 40 B 
* photo_id = 16 B
* post_id = 16 B
* count (like) = 4 B
* count (Comment) = 4 B

PostPlaces = 104 B
* photo_id = 16 B
* post_id = 16 B
* count (like) = 4 B
* count (Comment) = 4 B
* place_geo = 64 B

Post ~= 10 336 B
* post_id = 16 B
* author_id = 16 B
* description = 10 KB
* place_geo = 64 B

Comment ~= 564 B
* comment_id = 16 B
* post_id = 16 B
* user_id = 16 B
* description ~= 500 B
* parent_id = 16 B

Like = 32 B
* post_id = 16 B
* user_id = 16 B

Pohoto = 160 B
* photo_id = 16 B
* post_id = 16 B
* storage ~= 128 B
* photo_size ~= 1 MB

Follow = 32 B
* user_id = 16 B
* follower_id = 16 B

### Трафик на чтение:
* Лента (feed) 
  - средняя нагрузка: 1 157 rps * 40 B ~= 45 KB/s
  - пиковая нагрузка: 2 545 rps * 40 B ~= 99 KB/s
* Места (places) 
  - средняя нагрузка: 17 360 rps * 104 B ~= 1,7 MB/s
  - 38 192 rps * 104 B ~= 3,7 MB/s
* Пост (post) 
  - средняя нагрузка: 3 472 rps * 10 336 B ~= 34 MB/s
  - пиковая нагрузка: 7 638 rps * 10 336 B ~= 75 MB/s
* Комментарии (comments)
  - средняя нагрузка: 578 rps * 564 B ~= 318 KB/s
  - пиковая нагрузка: 1 271 rps * 564 B ~= 700 KB/s
* Лайки (likes)
  - средняя нагрузка: 16 203 rps * 32 B ~= 506 KB/s
  - пиковая нагрузка: 35 646 rps * 32 B ~= 1 MB/s
* Фото (photos)
  - средняя нагрузка: 21 990 rps * (160 B + 1 MB) ~= 21 GB/s
  - пиковая нагрузка: 48 378 rps * (160 B + 1 MB) ~= 47 GB/s

### Трафик на запись:
* Пост (post) 
  - средняя нагрузка: 16 rps * 10 336 B ~= 161 KB/s
  - пиковая нагрузка: 32 rps * 10 336 B ~= 323 KB/s
* Фото (photos)
  - средняя нагрузка: 82 rps * (160 B + 1 MB) ~= 82 MB/s
  - пиковая нагрузка: 164 rps * (160 B + 1 MB) ~= 164 MB/s
* Комментарии (comments)
  - средняя нагрузка: 1 157 rps * 564 B ~= 637 KB/s
  - пиковая нагрузка: 2 545 rps * 564 B ~= 1,3 MB/s
* Лайки (likes)
  - средняя нагрузка: 2 314 rps * 32 B ~= 72 KB/s
  - пиковая нагрузка: 5 090 rps * 32 B ~= 159 KB/s
* Подписка:
  - средняя нагрузка: 8 rps * 32 B ~= 256 B/s
  - пиковая нагрузка: 17 rps * 32 B ~= 544 B/s